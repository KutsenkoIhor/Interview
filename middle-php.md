# Middle PHP

## Оглавление
1. [Как передаются переменные (по значению или по ссылке)?](#1-как-передаются-переменные-по-значению-или-по-ссылке)
2. [Какие процессы происходят, когда пользователь вводит URL в браузере?](#2-какие-процессы-происходят-когда-пользователь-вводит-url-в-браузере)
3. [Что такое вариативная функция или splat-оператор?](#3-что-такое-вариативная-функция-или-splat-оператор)
4. [Что такое OWASP?](#4-что-такое-owasp)
5. [Какие типы уязвимостей вы знаете и как от них защищаться?](#5-какие-типы-уязвимостей-вы-знаете-и-как-от-них-защищаться)
6. [Что такое идемпотентные методы? Какие HTTP-методы являются идемпотентными в REST?](#6-что-такое-идемпотентные-методы-какие-http-методы-являются-идемпотентными-в-rest)
7. [Что такое stateless?](#7-что-такое-stateless)
8. [SOAP vs REST — в чем разница?](#8-soap-vs-rest-в-чем-разница)
9. [Какие методы авторизации используются для построения API?](#9-какие-методы-авторизации-используются-для-построения-api)
10. [Что может содержать интерфейс?](#10-что-может-содержать-интерфейс)
11. [Клонирование объектов и вложенные объекты (shallow / deep clone).](#11-клонирование-объектов-и-вложенные-объекты-shallow-deep-clone)
12. [Что такое Mock? Где используется и зачем?](#12-что-такое-mock-где-используется-и-зачем)
13. [Что такое PSR?](#13-что-такое-psr)
14. [Опишите реализацию одного из паттернов проектирования.](#14-опишите-реализацию-одного-из-паттернов-проектирования)
15. [Что такое Redis?](#15-что-такое-redis)
16. [Как хранятся данные в Redis и Memcached?](#16-как-хранятся-данные-в-redis-и-memcached)
17. [Redis и Memcached для кеширования: плюсы и минусы.](#17-redis-и-memcached-для-кеширования-плюсы-и-минусы)
18. [Отличия между nginx и Apache.](#18-отличия-между-nginx-и-apache)
19. [Что такое OPcache и как он работает?](#19-что-такое-opcache-и-как-он-работает)
20. [Что такое JIT и как он работает?](#20-что-такое-jit-и-как-он-работает)
21. [Зачем нужно ключевое слово final?](#21-зачем-нужно-ключевое-слово-final)
22. [Что нового в PHP 7 и PHP 8?](#22-что-нового-в-php-7-и-php-8)
23. [SOLID, DRY, KISS, YAGNI.](#23-solid-dry-kiss-yagni)
24. [Паттерны проектирования, с которыми приходилось работать.](#24-паттерны-проектирования-с-которыми-приходилось-работать)
25. [Что такое простая фабрика?](#25-что-такое-простая-фабрика)
26. [Что такое Service Layer и где его стоит применять?](#26-что-такое-service-layer-и-где-его-стоит-применять)
27. [Singleton: как устроен и почему является антипаттерном.](#27-singleton-как-устроен-и-почему-является-антипаттерном)
28. [Что такое идемпотентность?](#28-что-такое-идемпотентность)
29. [Жизненный цикл HTTP-запроса.](#29-жизненный-цикл-http-запроса)
30. [Что такое куча и стек?](#30-что-такое-куча-и-стек)
31. [Что такое рефлексия?](#31-что-такое-рефлексия)
32. [Что такое хеш-функция и где она используется?](#32-что-такое-хеш-функция-и-где-она-используется)
33. [Как используются очереди в PHP?](#33-как-используются-очереди-в-php)
34. [Как в общих чертах работает OPcache?](#34-как-в-общих-чертах-работает-opcache)
35. [Что такое GRASP?](#35-что-такое-grasp)
36. [Что такое TDD?](#36-что-такое-tdd)
37. [Чем отличаются модульные тесты от интеграционных?](#37-чем-отличаются-модульные-тесты-от-интеграционных)
38. [Что такое трейты и как применять их на практике?](#38-что-такое-трейты-и-как-применять-их-на-практике)
39. [Как решать конфликты при использовании trait?](#39-как-решать-конфликты-при-использовании-trait)
40. [Как работает автозагрузка классов?](#40-как-работает-автозагрузка-классов)
41. [Разница между стеком и очередью.](#41-разница-между-стеком-и-очередью)
42. [Unit и Functional тесты. Моки и стабы в PHP.](#42-unit-и-functional-тесты-моки-и-стабы-в-php)
43. [Как вызвать приватный метод (гипотетическая ситуация)?](#43-как-вызвать-приватный-метод-гипотетическая-ситуация)
44. [Разница между PHP-FPM и «PHP на сокете».](#44-разница-между-php-fpm-и-php-на-сокете)
45. [Как реализовать загрузку больших отчетов (1GB и более)?](#45-как-реализовать-загрузку-больших-отчетов-1gb-и-более)
46. [Как импортировать 50GB XML в базу данных?](#46-как-импортировать-50gb-xml-в-базу-данных)
47. [Почему после PHP 5 сразу вышел PHP 7, куда делся PHP 6?](#47-почему-после-php-5-сразу-вышел-php-7-куда-делся-php-6)
48. [Есть ли разница между self и $this в PHP?](#48-есть-ли-разница-между-self-и-this-в-php)
49. [Что такое PuTTY?](#49-что-такое-putty)
50. [Как запускать важный PHP-файл каждые 20 секунд?](#50-как-запускать-важный-php-файл-каждые-20-секунд)
51. [Как расшифровать права 644 для файла в Linux?](#51-как-расшифровать-права-644-для-файла-в-linux)
52. [Что такое Opcode?](#52-что-такое-opcode)

---
### 1. Как передаются переменные (по значению или по ссылке)?

<details>
<summary>Раскрыть:</summary>

В PHP аргументы функций **по умолчанию передаются по значению**.  
Это означает, что функция получает **копию значения**, а не саму переменную.

```php
function foo($a) {
    $a = 10;
}

$b = 5;
foo($b);
echo $b; // 5
```
Передача по ссылке выполняется с помощью оператора &.
```php
function foo(&$a) {
    $a = 10;
}

$b = 5;
foo($b);
echo $b; // 10
```
Важно:
* объекты в PHP передаются по значению ссылки
* & используется редко и требует аккуратности
* лишние ссылки могут усложнять отладку
</details>

---
### 2. Какие процессы происходят, когда пользователь вводит URL в браузере?

<details>
<summary>Раскрыть:</summary>

Основные этапы:

#### 1. Парсинг URL
* протокол, домен, путь, query
#### 2. DNS-запрос
* получение IP-адреса сервера
#### 3. Установка соединения
* TCP (3-way handshake)
* TLS (если HTTPS)
#### 4. HTTP-запрос
* отправка заголовков и тела
#### 5. Обработка на сервере
* web-сервер → PHP-FPM → приложение
#### 6. HTTP-ответ
* статус, заголовки, тело
#### 7. Рендеринг браузером
* HTML → CSS → JS → DOM
</details>

---
### 3. Что такое вариативная функция или splat-оператор?

<details>
<summary>Раскрыть:</summary>

**Вариативная функция** принимает произвольное количество аргументов.
```php
function sum(int ...$numbers): int {
    return array_sum($numbers);
}

sum(1, 2, 3); // 6
```
splat-оператор (...) также используется для распаковки массивов:
```php
$args = [1, 2, 3];
sum(...$args);
```
Используется:
* в прокси-методах
* в middleware
* для гибких API
</details>

---
### 4. Что такое OWASP?

<details>
<summary>Раскрыть:</summary>

**OWASP (Open Worldwide Application Security Project)** — международная организация,
занимающаяся безопасностью веб-приложений.

Самый известный документ — OWASP Top 10, список критических уязвимостей:
* SQL Injection
* XSS
* CSRF
* Broken Authentication
* Security Misconfiguration

Используется как стандарт secure-coding.
</details>

---
### 5. Какие типы уязвимостей вы знаете и как от них защищаться?

<details>
<summary>Раскрыть:</summary>

#### 1. SQL Injection
**Описание:**  
Атака, при которой злоумышленник внедряет SQL-код в пользовательский ввод, чтобы:
- получить доступ к данным,
- изменить данные,
- выполнить админские операции.
 
**Защита:**
- Использовать prepared statements:
  - PDO (prepare, bindParam)
  - Doctrine ORM / DBAL
- Никогда не конкатенировать SQL-строки
- Ограничивать права БД-пользователя

#### 2. XSS (Cross-Site Scripting)
**Описание:**  
Внедрение JavaScript-кода, который выполняется в браузере жертвы.

**Защита:**
- Экранирование вывода (htmlspecialchars, Twig auto-escape)
- Никогда не доверять данным от пользователя
- Content Security Policy (CSP):
  - запрет inline-скриптов
  - whitelist источников
- Использование безопасных шаблонизаторов

✅ Важно: экранируем на выводе, а не на входе

#### 3. CSRF (Cross-Site Request Forgery)
**Описание:**  
Атака, при которой пользователь неосознанно отправляет запрос от своего имени (например, перевод денег).

**Защита:**
- **CSRF-токены** (уникальные, одноразовые)
- Проверка Origin / Referer
- Cookies с флагом SameSite:
  - Lax / Strict
- Использование POST/PUT/DELETE для изменений

✅ Frameworks: Symfony CSRF, Laravel CSRF, Yii CSRF

#### 4. Broken Authentication
**Описание:**  
Ошибки в логике аутентификации:
- слабые пароли,
- утечка токенов,
- отсутствие ограничения попыток входа.

**Защита:**
- Хеширование паролей:
  - bcrypt
  - argon2id
- Ограничение количества login attempts
- JWT:
  - короткий TTL access-токена
  - refresh-токены
- HTTP-only cookies
- 2FA / MFA

❌ Никогда не хранить пароли в открытом виде
</details>

---
### 6. Что такое идемпотентные методы? Какие HTTP-методы являются идемпотентными в REST?

<details>
<summary>Раскрыть:</summary>

**Идемпотентность** — повторный вызов операции даёт тот же результат.

Идемпотентные HTTP-методы:
- GET
- PUT
- DELETE
- HEAD

Неидемпотентный:
- POST

Пример:
```php
PUT /users/1
```
</details>

---
### 7. Что такое stateless?

<details>
<summary>Раскрыть:</summary>

**Stateless** (без состояния) — это принцип, при котором **сервер не хранит информацию о состоянии клиента между запросами**.  
Каждый запрос обрабатывается **независимо** и содержит **всю необходимую информацию** для его выполнения.

#### Stateless в контексте HTTP

HTTP — это **stateless-протокол** по своей природе.

Это означает:
- сервер **не помнит** предыдущие запросы клиента,
- каждый HTTP-запрос самодостаточен,
- сервер не хранит данные о сессии между запросами.

**Пример:**
```http
GET /api/users/me
Authorization: Bearer <token>
```
</details>

---
### 8. SOAP vs REST. В чем разница?

<details>
<summary>Раскрыть:</summary>

**SOAP** и **REST** — это два разных подхода к построению веб-сервисов и API, которые отличаются философией, протоколами, форматом данных и областью применения.  

SOAP — это **строгий протокол обмена сообщениями**, основанный на XML и формальных контрактах.  
REST — это **архитектурный стиль**, а не протокол, использующий стандартные возможности HTTP.

| Критерий           | SOAP                     | REST                          |
|--------------------|--------------------------|-------------------------------|
| **Тип**            | Протокол                 | Архитектурный стиль           |
| **Формат данных**  | XML                      | JSON / XML                    |
| **Контракт**       | WSDL                     | OpenAPI (опционально)         |
| **Stateful**       | Может быть               | Stateless                     |
| **Производительность** | Ниже               | Выше                          |
| **Простота**       | Сложный                  | Простой                       |
| **Кеширование**    | Нет                      | Есть (HTTP Cache)             |
| **Безопасность**   | WS-Security              | HTTPS, OAuth, JWT             |

**Когда использовать SOAP**
- Корпоративные системы
- Банковские и финансовые интеграции
- Нужны транзакции и гарантированная доставка
- Требуется строгий контракт

**Когда использовать REST**
- Web / Mobile / SPA
- Микросервисы
- Высокая нагрузка
- Простота и скорость важнее формальностей

**Короткий ответ для собеседования**

**SOAP** — это строгий XML-протокол с контрактом WSDL, поддержкой транзакций и расширенной безопасности.  
**REST** — это архитектурный стиль, основанный на HTTP, stateless и чаще использующий JSON.  
**REST** проще, быстрее и лучше подходит для современных веб-приложений, SOAP — для enterprise-систем.
</details>

---
### 9. Какие методы авторизации используются для построения API?

<details>
<summary>Раскрыть:</summary>

Для API используются:
 - **Basic Auth** - Простейший механизм, при котором логин и пароль передаются в заголовке `Authorization`, закодированные в Base64.
 - **API Key** - Клиенту выдаётся уникальный ключ, который передаётся в каждом запросе.
 - **OAuth 2.0** - Стандарт авторизации, позволяющий безопасно делегировать доступ к ресурсам без передачи пароля.
 - **JWT** - Самодостаточный токен, содержащий информацию о пользователе и правах доступа, подписанный криптографически.
 - **Session + Cookie** - Классический подход, сервер хранит сессию, клиент передаёт session ID в cookie.

| Метод              | Stateless | Масштабируемость | Безопасность | Использование          |
|--------------------|-----------|------------------|--------------|------------------------|
| **Basic Auth**     | ❌        | ❌               | ❌           | Тесты                  |
| **API Key**        | ✅        | ✅               | ⚠️           | Service-to-service     |
| **OAuth 2.0**      | ✅        | ✅               | ✅           | Enterprise             |
| **JWT**            | ✅        | ✅               | ⚠️           | API, микросервисы      |
| **Session + Cookie** | ❌      | ❌               | ✅           | Web                    |

В микросервисах чаще всего применяют OAuth 2.0 для выдачи токенов и JWT как stateless-механизм авторизации.
</details>

---
### 10. Что может содержать интерфейс?

<details>
<summary>Раскрыть:</summary>

Интерфейс может содержать:
- объявления методов (все методы public, можно объявлять extends от других интерфейсов)
- константы (всегда public, нельзя переопределять значение константы в классе)

Не может содержать:
- реализацию методов
- свойства

| Критерий                   | Интерфейс | Абстрактный класс |
|----------------------------|-----------|-------------------|
| **Методы с реализацией**   | ❌        | ✅                |
| **Свойства**               | ❌        | ✅                |
| **Константы**              | ✅        | ✅                |
| **Множественное наследование** | ✅    | ❌                |
| **Конструктор**            | ❌        | ✅                |
</details>

---
### 11. Клонирование объектов и вложенные объекты (shallow / deep clone).

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 12. Что такое Mock? Где используется и зачем?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 13. Что такое PSR?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 14. Опишите реализацию одного из паттернов проектирования.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 15. Что такое Redis?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 16. Как хранятся данные в Redis и Memcached?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 17. Redis и Memcached для кеширования: плюсы и минусы.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 18. Отличия между nginx и Apache.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 19. Что такое OPcache и как он работает?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 20. Что такое JIT и как он работает?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 21. Зачем нужно ключевое слово final?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 22. Что нового в PHP 7 и PHP 8?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 23. SOLID, DRY, KISS, YAGNI.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 24. Паттерны проектирования, с которыми приходилось работать.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 25. Что такое простая фабрика?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 26. Что такое Service Layer и где его стоит применять?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 27. Singleton: как устроен и почему является антипаттерном.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 28. Что такое идемпотентность?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 29. Жизненный цикл HTTP-запроса.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 30. Что такое куча и стек?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 31. Что такое рефлексия?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 32. Что такое хеш-функция и где она используется?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 33. Как используются очереди в PHP?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 34. Как в общих чертах работает OPcache?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 35. Что такое GRASP?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 36. Что такое TDD?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 37. Чем отличаются модульные тесты от интеграционных?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 38. Что такое трейты и как применять их на практике?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 39. Как решать конфликты при использовании trait?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 40. Как работает автозагрузка классов?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 41. Разница между стеком и очередью.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 42. Unit и Functional тесты. Моки и стабы в PHP.

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 43. Как вызвать приватный метод (гипотетическая ситуация)?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 44. Разница между PHP-FPM и «PHP на сокете».

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 45. Как реализовать загрузку больших отчетов (1GB и более)?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 46. Как импортировать 50GB XML в базу данных?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 47. Почему после PHP 5 сразу вышел PHP 7, куда делся PHP 6?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 48. Есть ли разница между self и $this в PHP?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 49. Что такое PuTTY?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 50. Как запускать важный PHP-файл каждые 20 секунд?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 51. Как расшифровать права 644 для файла в Linux?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
### 52. Что такое Opcode?

<details>
<summary>Раскрыть:</summary>

...
</details>

---
